<!DOCTYPE html>
@using MyWebPlay.Model;
@using MyWebPlay.Extension

<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>C# | Asp Net Core | Công nghệ thông tin</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/MyWebPlay.styles.css" asp-append-version="true" />
    <link rel="icon" href="/images/imagex.png">
</head>
<body style="background-color:@TempData["mau_background"]">
    <script>
        //var queryString = window.location.search;
        //var urlParams = new URLSearchParams(queryString);
        //var closex = urlParams.get('closex');

        var ok = 0;

        if ('@TempData["UsingWebsite"]' == "false")
        {
            alert("⚠ Website hiện đang không hoạt động nên bây giờ bạn sẽ không thể sử dụng. Vui lòng quay lại sau, hoặc liên hệ tại email : mywebplay.website@gmail.com. Xin cảm ơn !");
            ok = 1;
            window.location.href = "/Home/LockedWeb";
        }

        if (ok ==0 && '@TempData["GetDataIP"]' == "true")
        {
            var s = '@TempData["urlCurrent"]';
            if (s == null || s == "")
            s = "Index";

        fetch('https://api.ipify.org?format=json')
  .then(response => response.json())
  .then(data => window.location.href ="/Home/GetUserIP?ip="+data.ip+"&currentUrl="+s);
        }

        if ('@TempData["AdminControl"]' == "false")
        {
        if (ok == 0 && '@TempData["lockedClient"]' == "true")
        {
            ok = 1;
            window.location.href = "/Home/LockedWebClient";
        }

        if (ok != 100 && '@TempData["Lock_Message"]' != null && '@TempData["Lock_Message"]' == "true")
        {
            @{
            TempData["Lock_Message"] = "";
        }
            ok = 1;
            alert("❤ [ADMIN] Đã [KHOÁ] kết nối trang web theo ID bạn yêu cầu !");
            var win = window.open("about:blank", "_self");
             win.close();
             window.close();
        }

         if (ok != 100 && '@TempData["Unlock_Message"]' != null && '@TempData["Unlock_Message"]' == "true")
        {
            @{
            TempData["Unlock_Message"] = "";
        }
            ok = 100;
             alert("❤ [ADMIN] Đã [MỞ KHOÁ] kết nối trang web theo ID bạn yêu cầu !");
             var win = window.open("about:blank", "_self");
             win.close();
             window.close();
        }

         if (ok != 100 && '@TempData["Logout_Message"]' != null && '@TempData["Logout_Message"]' == "true")
        {
            @{
            TempData["Logout_Message"] = "";
        }
            ok = 100;
            alert("❤ [ADMIN] Đã đăng xuất tất cả kết nối theo ID bạn yêu cầu, họ sẽ phải bật lại trang web !");
             var win = window.open("about:blank", "_self");
             win.close();
             window.close();
        }

         if (ok == 0 && '@TempData["PlayOnWebInLocal"]' == "true" && localStorage.getItem("keyX_PlayOnWeb") != "true")
        {
            ok = 10;
            localStorage.setItem("keyX_PlayOnWeb", "true");
            alert("Bạn đã bật trang web MyWebPlay thành công, bạn có thể sử dụng các tính năng tại trang web 😊!");
            window.location.href = "/Home/RemoveTempData";
        }


        if (ok == 0 && '@TempData["continue"]' == "OK" && localStorage.getItem("keyX_PlayOnWeb") != "true")
        {
            ok = 2;
            window.location.href="/Home/AcceptContinueUseWeb";
        }

         if (ok == 0 && '@TempData["ok-continue"]' == "yes" && localStorage.getItem("keyX_PlayOnWeb") != "true")
        {
            ok = 10;
            alert("Đã cấp phép thành công, bạn có thể tiếp tục sử dụng các tính năng tại trang web trên IDs mới này 😎 !");
            localStorage.setItem("keyX_PlayOnWeb", "true");
             window.location.href = "/Home/RemoveTempData";
        }

        if (ok == 0 && '@TempData["VisibleX"]' == "true" && localStorage.getItem("keyX_PlayOnWeb") != "true")
        {
            ok = 1;
            alert("Để tiếp tục sử dụng, vui lòng tìm cách để có lại được sự cấp phép. Nếu không, hãy tắt sử dụng trang web và yêu cầu bật sử dụng lại! ");
            window.location.href = "https://google.com";
        }

        if (ok == 0 && '@TempData["continue-X"]' == "NO" && localStorage.getItem("keyX_PlayOnWeb") == "true")
        {
            ok = 3;
            localStorage.removeItem("keyX_PlayOnWeb");
             window.location.href = "/Home/RemoveTempData";
        }

        if (ok == 0  && '@TempData["ok-continue-X"]' == "no")
        {
            ok = 10;
            localStorage.removeItem("keyX_PlayOnWeb");
             window.location.href = "/Home/RemoveTempData";
        }

        if (ok == 0 && '@TempData["lock"]' == "true")
        {
            ok = 4;
            alert("⚠ Trang web hiện đang bị khoá bởi người đảm quyền, không thể kết nối đối với một số trường hợp. Vì vậy, vui lòng chờ đợi sau khi admin duyệt và mở khoá để có thể tiếp tục. Nếu bạn muốn gửi email xin phép, liên hệ tại : mywebplay.website@gmail.com");
            window.location.href = "/Home/LockedWeb";
        }
        
         if (ok == 0 && ('@TempData["PlayOnWebInLocal-X"]' == "false" || ('@TempData["PlayOnWebInLocal"]' == "true" && localStorage.getItem("keyX_PlayOnWeb") == null)))
        {
            ok = 1;
            localStorage.removeItem("keyX_PlayOnWeb");
            if ('@TempData["InError"]' == null)
            alert("Bạn đã tắt trang web MyWebPlay thành công, để sử dụng lại hãy thực hiện các bước để bật 😎 !");
            else
            alert("⚠ Tất cả kết nối phiên bản của bạn hiện đã hết hạn sử dụng hoặc chưa được bật, vui lòng bật lại trang web để sử dụng !");
            window.location.href="/Home/LockedWeb";
         }
        }

        function muaxuan()
        {
            document.location.href= "#hihi";
        }

        var tim1 = 30;
        var idX1 = setInterval(myFay1, 1000);

        function myFay1()
        {
           if ($('#thoigian1').length)
           {
            var va = document.getElementById("thoigian1");
            va.innerHTML = tim1;
            tim1--;
            if (va.innerText == 0)
            {
                clearInterval(idX1);
                window.location.href="/Home/XoaAllFile_X1";
            }
           }
        }

         var tim2 = 30;
        var idX2 = setInterval(myFay2, 1000);

        function myFay2()
        {
           if ($('#thoigian2').length)
           {
            var va = document.getElementById("thoigian2");
            va.innerHTML = tim2;
            tim2--;
            if (va.innerText == 0)
            {
                clearInterval(idX2);
                window.location.href="/Home/XoaAllFile_X2";
            }
           }
        }

         var tim3 = 30;
        var idX3 = setInterval(myFay3, 1000);

        function copyResult()
        {
            var xu = document.getElementById("click_copy");

            var copyText = document.getElementById("txtResultX");

   // Copy the text inside the text field
  navigator.clipboard.writeText(copyText.value);

           xu.style.color = "green";
           xu.innerHTML = "COPY TO YOUR CLIPBOARD SUCCESS";
        }

        function myFay3()
        {
             if ($('#thoigian3').length)
           {
            var va = document.getElementById("thoigian3");
            va.innerHTML = tim3;
            tim3--;
            if (va.innerText == 0)
            {
                clearInterval(idX3);
                window.location.href="/Home/XoaKaraoke";
            }
           }
        }

        function khoawebsite()
        {
            window.location.href = "/Home/LockedWebClient";
        }

        function copyCurrent()
        {
            navigator.clipboard.writeText(document.getElementById("current").innerHTML);
        }
        </script>
        @if (TempData["AdminControl"] == "false")
    {
        <header>
            <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light border-bottom box-shadow mb-3" style="background-color:@TempData["mau_nen"]">
            <div class="container-fluid">
                <button style="color:deeppink" class="navbar-brand" asp-area="" onclick="khoawebsite()">Khoá WebSite bằng mật mã LockedClientID (<u>hãy cẩn thận đừng nhấn nhầm vào đây nếu bạn không có nhu cầu 😁</u>)</button>
                <a href="/Home/Index"><p style="color:orangered">BACK HOME MENU</p></a>
                <h2 style="color:@TempData["mau_winx"]">@TempData["winx"]</h2>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
        </nav>
    </header>
    }
    <div class="container">
        <main role="main" class="pb-3">
           <div style="color:@TempData["mau_text"]">
                   @if (TempData["AdminControl"] == "false")
    {
           <a href="#xuly" onclick="copyCurrent()"><h4 id="current" style="color:orangered">@TempData["current"]</h4></a>
               <br />
    }
           @if (TempData["GetDataIP"] == "true")
            {
                 <div hidden>@RenderBody()</div>
                 <img src="/Image_Play/waiting.gif" />
            }
            else
            { 
                @RenderBody()
            }
            </div>
        </main>
    </div>

    <footer class="border-top footer text-muted">
        <div class="container">
            &copy; 2023 - MyWebPlay - C# ~ Asp Net Core 7
        </div>
    </footer>
    <br />
     <br />
      <br />
       <br />
        <br />
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
